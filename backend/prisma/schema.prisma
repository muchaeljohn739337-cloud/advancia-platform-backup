generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // Connection URL moved to prisma.config.ts (Prisma 7)
}

model CryptoPayments {
  id               String    @id
  user_id          String
  invoice_id       String
  amount           Float
  currency         String
  status           String    @default("pending")
  payment_url      String?
  order_id         String?
  description      String?
  paid_at          DateTime?
  created_at       DateTime?
  updated_at       DateTime?
  paymentProvider  String?   @default("cryptomus") // 'cryptomus' | 'nowpayments'

  @@index([user_id])
  @@index([status])
  @@index([paymentProvider])
}

model RPAExecution {
  id          String             @id
  workflowId  String
  status      RPAExecutionStatus @default(RUNNING)
  trigger     Json
  steps       Json
  error       String?
  startedAt   DateTime           @default(now())
  completedAt DateTime?
  RPAWorkflow RPAWorkflow        @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([startedAt])
  @@index([status])
  @@index([workflowId])
}

model RPAWorkflow {
  id           String         @id
  name         String
  description  String?
  trigger      Json
  actions      Json
  enabled      Boolean        @default(true)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  createdById  String
  RPAExecution RPAExecution[]
  user         User           @relation(fields: [createdById], references: [id])

  @@index([createdById])
  @@index([enabled])
}

model activity_logs {
  id        String   @id
  userId    String?
  action    String
  ipAddress String
  userAgent String
  metadata  Json?
  createdAt DateTime @default(now())
}

model admin_login_logs {
  id        Int      @id @default(autoincrement())
  email     String
  phone     String?
  status    String
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())

  @@index([createdAt])
  @@index([email])
  @@index([status])
}

model admin_messages {
  id          String    @id
  userId      String
  fromAdminId String
  fromAdmin   String
  toUserId    String?
  subject     String?
  message     String
  attachments Json?
  priority    String    @default("normal")
  category    String?
  isRead      Boolean   @default(false)
  readAt      DateTime?
  repliedTo   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime

  @@index([createdAt])
  @@index([fromAdminId])
  @@index([isRead])
  @@index([repliedTo])
  @@index([userId])
}

model admin_notifications {
  id        String    @id
  type      String
  title     String
  message   String
  userId    String?
  metadata  Json?
  read      Boolean   @default(false)
  readAt    DateTime?
  actionUrl String?
  createdAt DateTime  @default(now())

  @@index([createdAt])
  @@index([read])
  @@index([type])
}

model admin_portfolios {
  id        String   @id
  currency  Currency @unique
  balance   Decimal  @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model admin_settings {
  id                   String   @id
  btcAddress           String?
  ethAddress           String?
  usdtAddress          String?
  ltcAddress           String?
  otherAddresses       String?
  exchangeRateBtc      Decimal?
  exchangeRateEth      Decimal?
  exchangeRateUsdt     Decimal?
  processingFeePercent Decimal  @default(2.5)
  minPurchaseAmount    Decimal  @default(10)
  debitCardPriceUSD    Decimal  @default(1000)
  updatedAt            DateTime
  createdAt            DateTime @default(now())
}

model admin_transfers {
  id        String   @id
  adminId   String?
  userId    String?
  currency  Currency
  amount    Decimal
  note      String?
  source    String?
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@index([createdAt])
  @@index([currency])
  @@index([userId])
}

model admin_user_notes {
  id        String   @id
  userId    String
  adminId   String
  noteType  String
  title     String
  content   String
  priority  String   @default("normal")
  tags      String?
  metadata  Json?
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@index([adminId])
  @@index([createdAt])
  @@index([noteType])
  @@index([userId])
}

model admin_wallet_transactions {
  id            String        @id
  adminWalletId String
  userId        String?
  amount        Decimal
  currency      String
  type          String
  description   String
  createdAt     DateTime      @default(now())
  admin_wallets admin_wallets @relation(fields: [adminWalletId], references: [id])
  user          User?         @relation(fields: [userId], references: [id])

  @@index([adminWalletId])
  @@index([type])
  @@index([userId])
}

model admin_wallets {
  id                        String                      @id
  currency                  String                      @unique
  balance                   Decimal                     @default(0)
  totalIn                   Decimal                     @default(0)
  totalOut                  Decimal                     @default(0)
  walletAddress             String?
  walletProvider            String?
  walletNotes               String?
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  admin_wallet_transactions admin_wallet_transactions[]
}

model alert_policies {
  id                String              @id
  routeGroup        String              @unique
  threshold         Int
  cooldown          Int                 @default(300000)
  mode              AlertMode           @default(IMMEDIATE)
  batchIntervalMs   Int?
  channels          String[]
  severity          AlertSeverity       @default(MEDIUM)
  enabled           Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  createdBy         String
  updatedBy         String
  policy_audit_logs policy_audit_logs[]

  @@index([routeGroup])
}

model analytics_events {
  id              String   @id
  userId          String?
  sessionId       String?
  eventName       String
  eventProperties Json?
  userProperties  Json?
  deviceInfo      Json?
  timestamp       DateTime @default(now())
  ipAddress       String?
  userAgent       String?
  referrer        String?
  url             String?
  platform        String?
  appVersion      String?
  createdAt       DateTime @default(now())

  @@index([createdAt])
  @@index([eventName])
  @@index([sessionId])
  @@index([timestamp])
  @@index([userId])
}

model audit_logs {
  id             String   @id
  userId         String?
  action         String
  resourceType   String
  resourceId     String
  changes        Json?
  previousValues Json?
  newValues      Json?
  metadata       Json?
  ipAddress      String?
  userAgent      String?
  timestamp      DateTime @default(now())
  createdAt      DateTime @default(now())
  details        Json?

  @@index([createdAt])
  @@index([resourceId])
  @@index([resourceType])
  @@index([timestamp])
  @@index([userId])
}

model backup_codes {
  id        String    @id
  userId    String
  code      String    @unique
  isUsed    Boolean   @default(false)
  usedAt    DateTime?
  createdAt DateTime  @default(now())

  @@index([code])
  @@index([isUsed])
  @@index([userId])
}

model chat_messages {
  id         String   @id
  sessionId  String
  senderType String
  senderId   String?
  content    String
  metadata   Json?
  createdAt  DateTime @default(now())
}

model chat_sessions {
  id              String   @id
  userId          String?
  status          String   @default("open")
  createdAt       DateTime @default(now())
  updatedAt       DateTime
  assignedAdminId String?
}

model consultation_messages {
  id             String   @id
  consultationId String
  senderType     String
  senderId       String
  content        String
  attachmentUrl  String?
  createdAt      DateTime @default(now())
}

model consultations {
  id           String             @id
  patientId    String
  doctorId     String
  status       ConsultationStatus @default(SCHEDULED)
  scheduledAt  DateTime?
  startedAt    DateTime?
  completedAt  DateTime?
  symptoms     String?
  diagnosis    String?
  prescription String?
  notes        String?
  videoRoomId  String?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime
}

model crypto_orders {
  id                String    @id
  userId            String
  cryptoType        String
  usdAmount         Decimal
  cryptoAmount      Decimal
  exchangeRate      Decimal
  processingFee     Decimal
  totalUsd          Decimal
  status            String    @default("pending")
  adminAddress      String
  txHash            String?
  adminNotes        String?
  userWalletAddress String?
  stripeSessionId   String?
  completedAt       DateTime?
  cancelledAt       DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime

  @@index([createdAt])
  @@index([cryptoType])
  @@index([status])
  @@index([userId])
}

model crypto_wallets {
  id            String   @id
  userId        String
  currency      String
  balance       Decimal  @default(0)
  address       String   @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  lockedBalance Decimal  @default(0)
  totalIn       Decimal  @default(0)
  totalOut      Decimal  @default(0)
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, currency])
  @@index([currency])
  @@index([userId])
}

model crypto_withdrawals {
  id                 String    @id
  userId             String
  cryptoType         String
  cryptoAmount       Decimal
  usdEquivalent      Decimal
  withdrawalAddress  String
  status             String    @default("pending")
  adminApprovedBy    String?
  adminNotes         String?
  txHash             String?
  networkFee         Decimal?
  approvedAt         DateTime?
  rejectedAt         DateTime?
  completedAt        DateTime?
  cancelledAt        DateTime?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime
  user_notes         String?
  amount             Decimal
  approvedBy         String?
  currency           String
  destinationAddress String
  requestedAt        DateTime  @default(now())
  paymentProvider    String?   @default("cryptomus") // 'cryptomus' | 'nowpayments'
  user               User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([cryptoType])
  @@index([currency])
  @@index([requestedAt])
  @@index([status])
  @@index([userId])
  @@index([paymentProvider])
  @@index([userId, status])
  @@index([status, requestedAt(sort: Desc)])
}

model debit_cards {
  id             String   @id
  userId         String
  cardNumber     String   @unique
  cardHolderName String
  expiryMonth    Int
  expiryYear     Int
  cvv            String
  cardType       String   @default("virtual")
  status         String   @default("active")
  balance        Decimal  @default(0)
  dailyLimit     Decimal  @default(1000)
  createdAt      DateTime @default(now())
  updatedAt      DateTime

  @@index([cardNumber])
  @@index([userId])
}

model doctors {
  id             String       @id
  email          String
  passwordHash   String
  firstName      String
  lastName       String
  specialization String
  licenseNumber  String
  phoneNumber    String?
  status         DoctorStatus @default(PENDING)
  verifiedAt     DateTime?
  verifiedBy     String?
  inviteCode     String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime
}

model email_logs {
  id         String    @id
  userId     String?
  to         String
  from       String    @default("noreply@advancia.com")
  subject    String
  template   String
  status     String    @default("pending")
  provider   String    @default("resend")
  providerId String?
  metadata   Json?
  error      String?
  sentAt     DateTime?
  openedAt   DateTime?
  clickedAt  DateTime?
  createdAt  DateTime  @default(now())
  user       User?     @relation(fields: [userId], references: [id])

  @@index([status])
  @@index([template])
  @@index([userId])
}

model eth_activity {
  id                String          @id
  userId            String?
  address           String
  addressNormalized String
  type              EthActivityType
  txHash            String?         @unique
  amountEth         Decimal
  status            String
  confirmations     Int             @default(0)
  blockNumber       Int?
  note              String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime

  @@index([addressNormalized])
  @@index([createdAt])
  @@index([type])
}

model fee_revenues {
  id              String   @id
  transactionId   String   @unique
  transactionType String
  userId          String
  baseCurrency    String
  baseAmount      Decimal
  feePercent      Decimal
  flatFee         Decimal
  totalFee        Decimal
  netAmount       Decimal
  revenueUSD      Decimal
  feeRuleId       String?
  createdAt       DateTime @default(now())

  @@index([baseCurrency])
  @@index([createdAt])
  @@index([transactionType])
  @@index([userId])
}

model fraud_alerts {
  id          String    @id
  userId      String
  alertType   String
  severity    String
  description String
  metadata    Json?
  ipAddress   String?
  resolved    Boolean   @default(false)
  resolvedAt  DateTime?
  resolvedBy  String?
  actionTaken String?
  notes       String?
  createdAt   DateTime  @default(now())

  @@index([alertType])
  @@index([createdAt])
  @@index([resolved])
  @@index([severity])
  @@index([userId])
}

model health_readings {
  id               String   @id
  userId           String
  heartRate        Int?
  bloodPressureSys Int?
  bloodPressureDia Int?
  steps            Int?
  sleepHours       Decimal?
  sleepQuality     String?
  weight           Decimal?
  temperature      Decimal?
  oxygenLevel      Int?
  stressLevel      String?
  mood             String?
  deviceId         String?
  deviceType       String?
  metadata         String?
  notes            String?
  recordedAt       DateTime @default(now())
  createdAt        DateTime @default(now())

  @@index([createdAt])
  @@index([recordedAt])
  @@index([userId])
}

model invoice_items {
  id          String   @id
  invoiceId   String
  description String
  quantity    Int      @default(1)
  unitPrice   Decimal
  amount      Decimal
  createdAt   DateTime @default(now())
  invoices    invoices @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
}

model invoices {
  id             String          @id
  invoiceNumber  String          @unique
  userId         String
  amount         Decimal
  currency       String          @default("USD")
  status         String          @default("pending")
  type           String          @default("transaction")
  billingName    String?
  billingEmail   String?
  billingAddress String?
  issueDate      DateTime        @default(now())
  dueDate        DateTime
  paidDate       DateTime?
  transactionId  String?         @unique
  pdfUrl         String?
  pdfGenerated   Boolean         @default(false)
  notes          String?
  metadata       Json?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime
  invoice_items  invoice_items[]
  transactions   transactions?   @relation(fields: [transactionId], references: [id])
  user           User            @relation(fields: [userId], references: [id])

  @@index([invoiceNumber])
  @@index([status])
  @@index([userId])
}

model ip_blocks {
  id        String    @id
  ip        String    @unique
  reason    String?
  until     DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime

  @@index([updatedAt])
}

model ip_reputations {
  id          String   @id
  ipAddress   String   @unique
  riskScore   Int      @default(0)
  isVPN       Boolean  @default(false)
  isProxy     Boolean  @default(false)
  isTor       Boolean  @default(false)
  isHosting   Boolean  @default(false)
  country     String?
  city        String?
  isp         String?
  blacklisted Boolean  @default(false)
  whitelisted Boolean  @default(false)
  notes       String?
  lastChecked DateTime @default(now())
  checkCount  Int      @default(1)
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@index([blacklisted])
  @@index([ipAddress])
  @@index([riskScore])
}

model kyc_verifications {
  id                   String    @id
  userId               String    @unique
  kycLevel             Int       @default(0)
  status               String    @default("not_started")
  firstName            String?
  lastName             String?
  dateOfBirth          DateTime?
  nationality          String?
  idDocumentType       String?
  idDocumentNumber     String?
  idDocumentFront      String?
  idDocumentBack       String?
  selfieImage          String?
  addressProof         String?
  addressLine1         String?
  addressLine2         String?
  city                 String?
  state                String?
  postalCode           String?
  country              String?
  phoneNumber          String?
  verifiedAt           DateTime?
  verifiedBy           String?
  rejectedAt           DateTime?
  rejectionReason      String?
  submittedAt          DateTime?
  dailyWithdrawLimit   Decimal   @default(100)
  monthlyWithdrawLimit Decimal   @default(1000)
  lifetimeLimit        Decimal   @default(10000)
  createdAt            DateTime  @default(now())
  updatedAt            DateTime

  @@index([kycLevel])
  @@index([status])
  @@index([userId])
  @@index([verifiedAt])
}

model loans {
  id               String    @id
  userId           String
  amount           Decimal
  interestRate     Decimal
  termMonths       Int
  monthlyPayment   Decimal
  remainingBalance Decimal
  status           String    @default("pending")
  purpose          String
  startDate        DateTime  @default(now())
  dueDate          DateTime
  approvedBy       String?
  approvedAt       DateTime?
  paidOffAt        DateTime?
  defaultedAt      DateTime?
  cancelledAt      DateTime?
  adminNotes       String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime

  @@index([createdAt])
  @@index([status])
  @@index([userId])
}

model medbeds_bookings {
  id              String   @id
  userId          String
  chamberType     String
  chamberName     String
  sessionDate     DateTime
  duration        Int
  cost            Decimal  @db.Decimal(10, 2)
  paymentMethod   String
  paymentStatus   String   @default("pending")
  transactionId   String?
  stripeSessionId String?
  status          String   @default("scheduled")
  effectiveness   Int?
  notes           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([paymentStatus])
  @@index([sessionDate])
  @@index([status])
  @@index([userId])
}

model notification_logs {
  id             String    @id
  notificationId String
  channel        String
  status         String
  errorMessage   String?
  sentAt         DateTime  @default(now())
  deliveredAt    DateTime?
  metadata       Json?

  @@index([channel])
  @@index([notificationId])
  @@index([sentAt])
  @@index([status])
}

model notification_preferences {
  id                String   @id
  userId            String   @unique
  emailEnabled      Boolean  @default(true)
  smsEnabled        Boolean  @default(false)
  inAppEnabled      Boolean  @default(true)
  pushEnabled       Boolean  @default(true)
  transactionAlerts Boolean  @default(true)
  securityAlerts    Boolean  @default(true)
  systemAlerts      Boolean  @default(true)
  rewardAlerts      Boolean  @default(true)
  adminAlerts       Boolean  @default(true)
  promotionalEmails Boolean  @default(false)
  enableDigest      Boolean  @default(false)
  digestFrequency   String   @default("daily")
  createdAt         DateTime @default(now())
  updatedAt         DateTime
}

model notifications {
  id          String    @id
  userId      String
  type        String
  priority    String    @default("normal")
  category    String
  title       String
  message     String
  data        Json?
  isRead      Boolean   @default(false)
  readAt      DateTime?
  emailSent   Boolean   @default(false)
  emailSentAt DateTime?
  smsSent     Boolean   @default(false)
  smsSentAt   DateTime?
  pushSent    Boolean   @default(false)
  pushSentAt  DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime

  @@index([category])
  @@index([createdAt])
  @@index([isRead])
  @@index([priority])
  @@index([userId])
}

model oal_audit_log {
  id          String    @id
  object      String
  action      String
  location    String
  subjectId   String?
  metadata    Json?
  status      OALStatus @default(PENDING)
  createdById String
  updatedById String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime

  @@index([action])
  @@index([createdAt])
  @@index([createdById])
  @@index([location])
  @@index([object])
  @@index([status])
  @@index([subjectId])
}

model password_reset_requests {
  id            String    @id
  userId        String
  email         String
  token         String    @unique
  expiresAt     DateTime
  used          Boolean   @default(false)
  usedAt        DateTime?
  ipAddress     String?
  userAgent     String?
  adminViewed   Boolean   @default(false)
  adminViewedBy String?
  adminViewedAt DateTime?
  createdAt     DateTime  @default(now())

  @@index([createdAt])
  @@index([email])
  @@index([token])
  @@index([userId])
}

model payment_sessions {
  id            String    @id
  sessionId     String    @unique
  userId        String
  amount        Decimal
  currency      String    @default("USD")
  paymentMethod String
  provider      String?
  status        String    @default("pending")
  redirectUrl   String?
  callbackUrl   String?
  metadata      Json?
  expiresAt     DateTime
  completedAt   DateTime?
  failedReason  String?
  transactionId String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime

  @@index([createdAt])
  @@index([expiresAt])
  @@index([sessionId])
  @@index([status])
  @@index([userId])
}

model policy_audit_logs {
  id             String         @id
  policyId       String
  action         String
  changedBy      String
  userEmail      String
  userRole       String
  ipAddress      String?
  userAgent      String?
  changesBefore  Json?
  changesAfter   Json
  reason         String?
  timestamp      DateTime       @default(now())
  entryHash      String?
  prevHash       String?
  signature      String?
  alert_policies alert_policies @relation(fields: [policyId], references: [id], onDelete: Cascade)

  @@index([changedBy])
  @@index([entryHash])
  @@index([policyId])
  @@index([timestamp])
}

model push_subscriptions {
  id         String   @id
  userId     String
  endpoint   String
  p256dh     String
  auth       String
  deviceInfo Json?
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now())

  @@unique([userId, endpoint])
  @@index([isActive])
  @@index([userId])
}

model rewards {
  id          String    @id
  userId      String
  type        String
  amount      Decimal
  status      String    @default("pending")
  title       String
  description String
  metadata    String?
  expiresAt   DateTime?
  claimedAt   DateTime?
  createdAt   DateTime  @default(now())

  @@index([createdAt])
  @@index([status])
  @@index([type])
  @@index([userId])
}

model sessions {
  id        String   @id
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([token])
  @@index([userId])
}

model support_tickets {
  id         String    @id
  userId     String
  subject    String
  message    String
  category   String    @default("GENERAL")
  status     String    @default("OPEN")
  priority   String    @default("MEDIUM")
  response   String?
  resolvedBy String?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime
  resolvedAt DateTime?

  @@index([status])
  @@index([userId])
}

model system_alerts {
  id          String    @id
  alertType   String
  severity    String
  title       String
  description String
  serviceName String?
  isResolved  Boolean   @default(false)
  resolvedAt  DateTime?
  resolvedBy  String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime

  @@index([alertType])
  @@index([createdAt])
  @@index([isResolved])
  @@index([severity])
}

model system_config {
  id        Int      @id @default(autoincrement())
  key       String   @unique
  value     String
  updatedAt DateTime
  createdAt DateTime @default(now())
}

model system_status {
  id            String   @id
  serviceName   String
  status        String
  responseTime  Int?
  uptime        Decimal?
  lastChecked   DateTime @default(now())
  statusMessage String?
  alertLevel    String   @default("none")
  metadata      String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime

  @@index([alertLevel])
  @@index([lastChecked])
  @@index([serviceName])
  @@index([status])
}

model token_transactions {
  id          String   @id
  walletId    String
  amount      Decimal
  type        String
  status      String   @default("completed")
  description String?
  toAddress   String?
  fromAddress String?
  txHash      String?
  metadata    String?
  createdAt   DateTime @default(now())

  @@index([createdAt])
  @@index([status])
  @@index([type])
  @@index([walletId])
}

model token_wallets {
  id             String   @id
  userId         String   @unique
  balance        Decimal  @default(0)
  tokenType      String   @default("ADVANCIA")
  lockedBalance  Decimal  @default(0)
  lifetimeEarned Decimal  @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime

  @@index([userId])
}

model transaction_fees {
  id          String   @id
  feeType     String
  currency    String?
  feePercent  Decimal  @default(0)
  flatFee     Decimal  @default(0)
  minFee      Decimal  @default(0)
  maxFee      Decimal?
  active      Boolean  @default(true)
  priority    Int      @default(0)
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  createdBy   String?

  @@index([active])
  @@index([currency])
  @@index([feeType])
  @@index([priority])
}

model transactions {
  id          String    @id
  userId      String
  amount      Float
  type        String
  description String?
  category    String?
  status      String    @default("completed")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  currency    String    @default("USD")
  orderId     String?   @unique
  provider    String?
  invoices    invoices?

  @@index([createdAt])
  @@index([orderId])
  @@index([provider])
  @@index([userId])
  @@index([userId, createdAt(sort: Desc)])
  @@index([status, type])
}

model trustpilot_reviews {
  id           String       @id
  reviewId     String       @unique
  userId       String?
  userName     String
  userEmail    String?
  rating       Int
  title        String
  content      String
  date         DateTime
  verified     Boolean      @default(false)
  helpful      Int          @default(0)
  notHelpful   Int          @default(0)
  response     String?
  responseDate DateTime?
  tags         String[]     @default([])
  source       String       @default("trustpilot")
  status       ReviewStatus @default(PENDING)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime
  user         User?        @relation(fields: [userId], references: [id])
}

model two_factor_auth {
  id          String   @id
  userId      String   @unique
  secret      String
  enabled     Boolean  @default(false)
  backupCodes String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model user_activities {
  id         String   @id @default(cuid())
  userId     String
  email      String
  action     String
  details    Json?
  ipAddress  String?
  userAgent  String?
  location   String?
  successful Boolean  @default(true)
  metadata   Json?
  createdAt  DateTime @default(now())

  @@index([action])
  @@index([createdAt])
  @@index([email])
  @@index([userId])
}

model user_profiles {
  id        String   @id
  userId    String   @unique
  bio       String?
  createdAt DateTime
  updatedAt DateTime
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model user_tiers {
  id              String   @id
  userId          String   @unique
  currentTier     String   @default("bronze")
  points          Int      @default(0)
  lifetimePoints  Int      @default(0)
  lifetimeRewards Decimal  @default(0)
  streak          Int      @default(0)
  longestStreak   Int      @default(0)
  lastActiveDate  DateTime @default(now())
  achievements    String?
  badges          String?
  referralCode    String?  @unique
  referredBy      String?
  totalReferrals  Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime

  @@index([currentTier])
  @@index([points])
  @@index([referralCode])
  @@index([userId])
}

model User {
  id                        String                      @id @default(cuid())
  email                     String                      @unique
  username                  String                      @unique
  passwordHash              String
  firstName                 String?
  lastName                  String?
  role                      Role                        @default(USER)
  usdBalance                Decimal                     @default(0)
  active                    Boolean                     @default(true)
  emailVerified             Boolean                     @default(false)
  emailVerifiedAt           DateTime?
  lastLogin                 DateTime?
  termsAccepted             Boolean                     @default(false)
  termsAcceptedAt           DateTime?
  totpSecret                String?
  totpEnabled               Boolean                     @default(false)
  totpVerified              Boolean                     @default(false)
  backupCodes               String?
  ethWalletAddress          String?                     @unique
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime                    @updatedAt
  btcBalance                Decimal                     @default(0)
  ethBalance                Decimal                     @default(0)
  usdtBalance               Decimal                     @default(0)
  address                   String?
  approved                  Boolean                     @default(false)
  approvedAt                DateTime?
  approvedBy                String?
  city                      String?
  country                   String?
  phoneNumber               String?
  postalCode                String?
  profileImage              String?
  rejectedAt                DateTime?
  rejectionReason           String?
  emailSignupToken          String?                     @unique
  emailSignupTokenExpiry    DateTime?
  firstLoginCompleted       Boolean                     @default(false)
  signupMethod              String                      @default("password")
  stripeCustomerId          String?                     @unique
  gpt5Enabled               Boolean                     @default(false)
  whitelistedIPs            String[]
  RPAWorkflow               RPAWorkflow[]
  admin_wallet_transactions admin_wallet_transactions[]
  crypto_wallets            crypto_wallets[]
  crypto_withdrawals        crypto_withdrawals[]
  email_logs                email_logs[]
  invoices                  invoices[]
  medbeds_bookings          medbeds_bookings[]
  trustpilot_reviews        trustpilot_reviews[]
  two_factor_auth           two_factor_auth?
  user_profiles             user_profiles?
  whitelisted_addresses     WhitelistedAddress[]

  // Project Management Relations
  ownedTeams                Team[]                     @relation("TeamOwner")
  teamMemberships           TeamMember[]               @relation("TeamMemberships")
  ownedProjects             Project[]                  @relation("ProjectOwner")
  assignedTasks             Task[]                     @relation("TaskAssignee")
  reportedTasks             Task[]                     @relation("TaskReporter")

  @@index([email])
  @@index([role])
  @@index([active])
  @@index([emailVerified])
  @@map("users")
}

model WhitelistedAddress {
  id        String   @id @default(cuid())
  userId    String
  address   String
  currency  String
  label     String?
  verified  Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, address, currency])
  @@index([userId])
  @@index([verified])
  @@map("whitelisted_addresses")
}

model withdrawal_queue {
  id            String    @id
  withdrawalId  String    @unique
  userId        String
  cryptoType    String
  amount        Decimal
  priority      Int       @default(0)
  status        String    @default("queued")
  attemptCount  Int       @default(0)
  lastAttemptAt DateTime?
  errorMessage  String?
  assignedTo    String?
  estimatedTime DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime

  @@index([estimatedTime])
  @@index([priority])
  @@index([status])
  @@index([userId])
  @@index([withdrawalId])
}

enum AlertMode {
  IMMEDIATE
  BATCHED
  MIXED
}

enum AlertSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum ConsultationStatus {
  SCHEDULED
  ACTIVE
  COMPLETED
  CANCELLED
}

enum Currency {
  USD
  ETH
  BTC
}

enum DoctorStatus {
  PENDING
  VERIFIED
  SUSPENDED
}

enum EthActivityType {
  DEPOSIT
  WITHDRAWAL
}

enum OALStatus {
  PENDING
  APPROVED
  REJECTED
}

enum RPAExecutionStatus {
  RUNNING
  SUCCESS
  FAILED
}

enum ReviewStatus {
  PENDING
  APPROVED
  REJECTED
  HIDDEN
}

enum Role {
  USER
  STAFF
  ADMIN
  SUPERADMIN
}

enum TeamRole {
  OWNER
  ADMIN
  MANAGER
  MEMBER
  VIEWER
}

enum ProjectStatus {
  PLANNING
  ACTIVE
  ON_HOLD
  COMPLETED
  ARCHIVED
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  IN_REVIEW
  DONE
  CANCELLED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

model Team {
  id          String   @id @default(cuid())
  name        String
  description String?
  ownerId     String
  settings    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  owner       User           @relation("TeamOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  members     TeamMember[]
  projects    Project[]

  @@index([ownerId])
  @@index([createdAt])
  @@map("teams")
}

model TeamMember {
  id        String   @id @default(cuid())
  teamId    String
  userId    String
  role      TeamRole @default(MEMBER)
  joinedAt  DateTime @default(now())
  updatedAt DateTime @updatedAt

  team      Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user      User     @relation("TeamMemberships", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
  @@index([teamId])
  @@index([userId])
  @@index([role])
  @@map("team_members")
}

model Project {
  id          String        @id @default(cuid())
  name        String
  description String?
  teamId      String
  ownerId     String
  status      ProjectStatus @default(PLANNING)
  startDate   DateTime?
  endDate     DateTime?
  settings    Json?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  team        Team          @relation(fields: [teamId], references: [id], onDelete: Cascade)
  owner       User          @relation("ProjectOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  tasks       Task[]
  milestones  Milestone[]

  @@index([teamId])
  @@index([ownerId])
  @@index([status])
  @@index([createdAt])
  @@map("projects")
}

model Task {
  id          String     @id @default(cuid())
  title       String
  description String?
  projectId   String
  assigneeId  String?
  reporterId  String
  status      TaskStatus @default(TODO)
  priority    Priority   @default(MEDIUM)
  tags        String[]
  dueDate     DateTime?
  completedAt DateTime?
  estimatedHours Float?
  actualHours Float?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  project     Project    @relation(fields: [projectId], references: [id], onDelete: Cascade)
  assignee    User?      @relation("TaskAssignee", fields: [assigneeId], references: [id], onDelete: SetNull)
  reporter    User       @relation("TaskReporter", fields: [reporterId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([assigneeId])
  @@index([reporterId])
  @@index([status])
  @@index([priority])
  @@index([dueDate])
  @@index([createdAt])
  @@map("tasks")
}

model Milestone {
  id          String    @id @default(cuid())
  title       String
  description String?
  projectId   String
  dueDate     DateTime?
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([dueDate])
  @@index([createdAt])
  @@map("milestones")
}

model FailedJob {
  id          String   @id @default(uuid())
  jobId       String
  type        String
  priority    Int
  data        String   // JSON string
  error       String
  stackTrace  String?
  attempts    Int
  failedAt    DateTime @default(now())

  @@index([type])
  @@index([priority])
  @@index([failedAt])
}
